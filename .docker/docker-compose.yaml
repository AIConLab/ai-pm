#File: .docker/docker-compose.yml
services:
  py-base:
    build:
      context: .
      dockerfile: Dockerfile.python
    user: "${UID:-1000}:${GID:-1000}"
    env_file: .env
    ports:
      - "5000:5000"

  # Listens to minecraft events and generates an appropiate response
  event_listener:
    extends: py-base
    volumes:
      - ../ai-pm:/scripts
      - /root/ai-pm-mc-world-dev/minecraft-dev/:/mc-data:ro
    command: bash -c "python3 /scripts/mc_event_listener.py"


  nbt:
    extends: py-base
    volumes:
      - ../ai-pm:/scripts
      - /root/ai-pm-mc-world-dev/minecraft-dev/:/mc-data:ro
    command: bash -c "python3 /scripts/test-nbt.py"

  minecraft:
    image: itzg/minecraft-server:latest
    user: "${UID:-1000}:${GID:-1000}"
    environment:
      EULA: "TRUE"
      TYPE: "PAPER"
      VERSION: "1.21.4"
      MEMORY: "2G"
      DIFFICULTY: "peaceful"
      MODE: "creative"
      MAX_PLAYERS: 20
      ONLINE_MODE: "true"
      WHITE_LIST: "false"
      ENABLE_COMMAND_BLOCK: "true"
      LEVEL_TYPE: "flat"
      OPS: "Loopking,BT1013,jc_cr"
      RCON_CMDS_STARTUP: |-
            gamerule doDaylightCycle false
            time set day
            gamerule doWeatherCycle false
            weather clear
    ports:
      - "25565:25565"
    volumes:
      - ../minecraft-dev:/data
    restart: unless-stopped

  latex:
      user: "${UID:-1000}:${GID:-1000}"
      build:
        context: ..
        dockerfile: .docker/Dockerfile.latex 
      ports:
        - "3000:3000"  # For LaTeX Workshop
      working_dir: /project
      command: tail -f /dev/null
      volumes:
       - ../paper/src:/project/src
       - ../paper/output:/project/output
       - ../paper/figures:/project/figures
       - ../paper/include:/project/include

